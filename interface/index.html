<!DOCTYPE html>
<html lang="en">
<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <title>CB Metrics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="../css/bootstrap.css" rel="stylesheet">
    <link href="../css/controlfrog.css" rel="stylesheet" media="screen">
	<!--<link href="http://leapfrogui.com/controlfrog-v1.4/cf/favicon.ico" rel="shortcut icon" type="image/x-icon" />-->
	<script src="../js/url.js"></script>
	<script src="../js/jquery-1.9.1.min.js"></script>
	<script src="../js/moment.js"></script>
	<script src="../js/easypiechart.js"></script>
	<script src="../js/gauge.js"></script>
	<script src="../js/chart.js"></script>
	<script src="../js/jquery.sparklines.js"></script>
    <script src="../js/bootstrap.js"></script>
    <script src="../js/controlfrog-plugins.js"></script>
    
    <!--[if lt IE 9]>
		<script src="../js/respond.min.js"></script>
		<script src="../js/excanvas.min.js"></script>
	<![endif]-->
    
    
	<script>
		var themeColour = 'white';
	</script>
    <script src="../js/controlfrog.js"></script>
</head>
<body class="black">
	
	<div class="cf-nav cf-nav-state-min">
		<a href="#" class="cf-nav-toggle">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</a>
		
		<!--<ul>
			<li class="cf-nav-shortcut">
				<a href="layout-1.html">
					<span class="cf-nav-min">1</span>
					<span class="cf-nav-max">Layout 1</span>
				</a>
			</li>
			<li class="cf-nav-shortcut">
				<a href="layout-2.html">
					<span class="cf-nav-min">2</span>
					<span class="cf-nav-max">Layout 2</span>
				</a>
			</li>
			<li class="current cf-nav-shortcut">
				<a href="index.html" class="current active">
					<span class="cf-nav-min">3</span>
					<span class="cf-nav-max">Layout 3</span>
				</a>
			</li>
			<li class="cf-nav-shortcut">
				<a href="layout-4.html">
					<span class="cf-nav-min">4</span>
					<span class="cf-nav-max">Layout 4</span>
				</a>
			</li>
			<li>
				<a href="#">
					<span class="cf-nav-min">&bull;</span>				
					<span class="cf-nav-max">Example with no shortcut</span>
				</a>
			</li>
		</ul>-->
	</div>
	
	<div class="cf-container cf-nav-active">

		<div class="row">
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Total API Count</p>
				</header>
				<div class="content">
					<div class="cf-svmc-sparkline">
						<div class="cf-svmc">
							<div class="metric" id="apiCount">0</div>
							<div class="change m-green metric-small">
								<!--<div class="arrow-up"></div>
								<span class="large">32<span class="small">.45%</span></span>-->
							</div>
						</div>
						<div class="cf-sparkline clearfix">
							<div id="spark-1" class="sparkline"></div>
							<div class="sparkline-value">
								<div class="metric-small">0</div>
							</div>
						</div>
					</div>
				</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>API Count of the Day</p>
				</header>
				<div class="content cf-gauge" id="cf-gauge-1">
					<div class="val-current">
						<div class="metric" id="cf-gauge-1-m">0</div>
					</div>
					<div class="canvas">
						<canvas id="cf-gauge-1-g"></canvas>
					</div>
					<div class="val-min">
						<div class="metric-small">0</div>
					</div>
					<div class="val-max">
						<div class="metric-small">0</div>						
					</div>
				</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<!--
	Display the time and date
	For 12hr clock add class 'cf-td-12' to the 'cf-td' div
-->

<header>
	<p><span></span>Time &amp; date</p>
</header>
<div class="content">
	<div class="cf-td">
	<!-- <div class="cf-td cf-td-12">-->
		<div class="cf-td-time metric">12:00</div>
		<div class="cf-td-dd">
			<p class="cf-td-day metric-small">Monday</p>
			<p class="cf-td-date metric-small">1st October, 2013</p>
		</div>
	</div>
</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Active APPS</p>
				</header>
				<div class="content">
					<div class="cf-svmc">
						<div class="metric" id="activeApps">0</div>
						<div class="change m-red metric-small">
							<div class="arrow-down" id="activeAppsDown" ></div>
                            <div class="arrow-up" id="activeAppsUp"></div>
							<span class="large" id="changeInApps"></span>
						</div>
					</div>
				</div>
			</div> <!-- //end cf-item -->
		</div> <!-- //end row -->
	
		<div class="row">
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Requests Pie chart</p>
				</header>
				<div class="content cf-pie" id="cf-pie-1">
					<canvas id="cf-pie-1-c" width="0" height="0"></canvas>
				</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Requests Classified</p>
				</header>
				<div class="content">
					<div id="cf-rag-1" class="cf-rag"></div>
				</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Top Active Apps</p>
				</header>
				<div class="content">
					<div id="cf-funnel-1" class="cf-funnel"></div>
				</div>
			</div> <!-- //end cf-item -->
			<div class="col-sm-3 cf-item">
				<header>
					<p><span></span>Method Wise Stats</p>
				</header>
				<div class="content cf-svp clearfix" id="svp-1">
				</div>
			</div>
		</div>

	</div> <!-- //end container -->

    <script>
        $(document).ready(function(){
            var apiCount = 0;
            $.ajax({
                url: url+"count",
                data: {"name":"apiCount"},
                type: "POST",
                success: function(response){
                    $("#cf-gauge-1-m").text(response);
                    $("#apiCount").text(response)
                },
                error: function(response){
                    console.log(response);
                }
            });
        });

        $(document).ready(function(){
            window.cf_defaultSparkOpts = {};
            cf_defaultSparkOpts.fillColor = false;
            cf_defaultSparkOpts.lineColor = metric;
            cf_defaultSparkOpts.lineWidth = 1.5;
            cf_defaultSparkOpts.minSpotColor = false;
            cf_defaultSparkOpts.maxSpotColor = false;
            cf_defaultSparkOpts.spotRadius = 2.5;
            cf_defaultSparkOpts.highlightLineColor = metric;
            cf_defaultSparkOpts.spotColor = '#f8f77d';
            var sparkOptions = cf_defaultSparkOpts;
            $.ajax({
                url: url+"apiGraph",
                type: "POST",
                success: function(response){
                    console.log(response);
                    var gid = "cf-gauge-1";
                    var maxVal = 1000;
                    do{
                        maxVal = maxVal * 10;
                    }while(response[response.length-1].requests > maxVal  );
                    var obj ={
                        minVal:0,
                        maxVal:maxVal,
                        newVal:response[response.length-1].requests
                    };
                    gaugeUpdate(gid,obj);
                    var data=[];
                    for(var i=0;i<response.length;i++){
                        data.push(response[i].requests);
                    }
                    createSparkline($("#spark-1"), data, sparkOptions);
                },
                error: function(response){
                    console.log(response);
                }
            });
        });

        $(document).ready(function(){
            $.ajax({
                url: url+"apiAppStats",
                type: "POST",
                success: function(response){
                    response.sort(function(a,b){return b.requests-a.requests});
                    console.log(response);
                    var funData =[];
                    var funLabels = [];
                    var funOptions = [];
                    $('.cf-funnel').each(function(){
                        for(var i=0;i<response.length;i++) {
                            funData.push(response[i].requests);
                            funLabels.push(response[i].host+'_'+response[i].appid);
                            funOptions = {barOpacity: true};
                        }

                        cf_rFunnels[$(this).prop('id')] = new FunnelChart($(this).prop('id'), funData, funLabels, funOptions);
                    });
                },
                error: function(response){
                    console.log(response);
                }
            });
        });

        $(document).ready(function(){
            $.ajax({
                url: url+"apiActiveApps",
                type: "POST",
                success: function(response)
                    {
                        console.log(response);
                        var change =0;
                        var currApps = response[response.length - 1].activeapps;
                        if(response.length>1) {
                            var prevApps = response[response.length - 2].activeapps;
                            if (currApps >= prevApps) {
                                change = currApps - prevApps;
                                $("#activeAppsDown").hide();
                            } else {
                                var change = currApps - prevApps;
                                $("#activeAppsUp").hide();
                            }
                            if (prevApps != 0) {
                                change = change / prevApps;
                            }
                            change = change * 100;
                            change = change.toString() + '%';
                            $("#changeInApps").text(change);
                        }else{
                            $("#activeAppsDown").hide();
                            $("#activeAppsUp").hide();
                        }
                        $("#activeApps").text(currApps);
                },
                error: function(response){
                    console.log(response);
                }
            });
        });

        $(document).ready(function(){
            $.ajax({
                url: url+"apiMethodStats",
                type: "POST",
                success: function(response)
                {
                    var pieData = {"storage":0,"search":0,"file":0};
                    var fileOps = ['fileUpload','fileDelete','getFile'];
                    var ragData =[];
                    var ragLabels = [];
                    $('.cf-rag').each(function(){
                        for(var i=0;i<response.length;i++) {
                            if(fileOps.indexOf(response[i].method) === -1){
                                if(response[i].method === 'search'){
                                    pieData["search"] = pieData["search"]+1;
                                }else{
                                    pieData["storage"] = pieData["storage"]+1;
                                }
                            }else{
                                pieData["file"] = pieData["file"]+1;
                            }
                        }
                        ragData = [pieData.storage,pieData.search,pieData.file]
                        ragLabels = ['Storage','Search','File'];
                        cf_rRags[$(this).prop('id')] = new RagChart($(this).prop('id'), ragData, ragLabels, ragOpts);
                        window.cf_DefaultPieOpts = {};
                        cf_DefaultPieOpts.segmentShowStroke = false;


                        $('.cf-pie').each(function(){
                                    var pdata = [
                                        {
                                            value : pieData.storage,
                                            color : pieSegColors[3],
                                            label: 'Storage'
                                        },
                                        {
                                            value : pieData.search,
                                            color : pieSegColors[2],
                                            label: 'Search'
                                        },
                                        {
                                            value: pieData.file,
                                            color: pieSegColors[1],
                                            label: 'File'
                                        }
                                    ]
                                    var $container = $(this);
                                    var pId = $container.prop('id');
                                    // Store chart information
                                    cf_rPs[pId] = {};
                                    cf_rPs[pId].data = pdata;
                                    createPieChart($container);
                                });

                    });
                },
                error: function(response){
                    console.log(response);
                }
            });
        });

        $(document).ready(function(){
            $.ajax({
                url: url+"apiMethodStats",
                type: "POST",
                success: function(response) {
                    var table = "<tr><th>Name</th><th>Requests</th></tr>";
                    for(var i=0;i<response.length;i++){
                        table = table + "<tr><td>"+response[i].method+"</td><td>"+response[i].requests+"</td></tr>";
                    }
                    $("#svp-1").append(table);
                },
                error: function(err){
                    console.log(err);
                }
            });
        });
    </script>

</body>

</html>